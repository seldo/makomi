var util = require('util');

/**
 * Middleware that will conditionally route a request if the referrer
 * matches a given pattern.
 */
module.exports = function(referrerRegex,handler) {

  return function(req,res,next) {

    var referrer = req.headers['referer'] // because fuck spelling, that's why
    var matches;
    if (referrer && (matches = referrer.match(referrerRegex))) {
      handler(req,res,next,matches)
    } else {
      next()
    }

  }

}