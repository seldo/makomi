/*!
 * oath - Node.js event emitter.
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 */

!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("oath",function(){function c(a){a=a||{},this._pending={},this._oath={complete:!1,context:a.context||this};var b=this;this.promise={then:function(a,c,d){return a&&b._register("resolve",a),c&&b._register("reject",c),d&&b._register("progress",d),b._oath.complete&&b._traverse(),this},onprogress:function(a){return b._register("progress",a),this},node:function(a){return this.then(function(b){a(null,b)},function(b){a(b)}),this}}}if(!a)var a={};var b=a.exports=c;return b.version="0.2.3",c.prototype.resolve=function(a){this._fulfill("resolve",a)},c.prototype.reject=function(a){this._fulfill("reject",a)},c.prototype.progress=function(a){var b=this._pending.progress;if(!b)return!1;for(var c=0;c<b.length;c++)b[c](a)},c.prototype.node=function(){var a=this;return function(){if(arguments[0])return a.reject(arguments[0]);var b=Array.prototype.slice.call(arguments,1,arguments.length);a.resolve.apply(a,b)}},c.prototype._register=function(a,b){var c=this._oath.context,d=this._pending[a],e;if(b.length<2)e=function(a){return b.call(c,a)};else if(b.length==2)e=function(a,d){b.call(c,a,d)};else throw new Error("Oath: Invalid function registered - to many parameters.");d?d.push(e):this._pending[a]=[e]},c.prototype._fulfill=function(a,b){if(this._oath.complete)return!1;this._oath.complete={type:a,result:b},this._traverse()},c.prototype._traverse=function(){var a=this,b=this._oath.context,c=this._oath.complete.type;if(!this._pending[c])return!1;var d=function(){var b=a._pending[c].shift(),e=a._oath.complete.result;if(b.length<2){var f=b(e);f&&(a._oath.complete.result=f),a._pending[c].length&&d()}else{var g=function(b){b&&(a._oath.complete.result=b),a._pending[c].length&&d()};b(e,g)}};d()},b})